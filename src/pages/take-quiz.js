import Head from 'next/head';
import styles from '../styles/Home.module.css';
import { useRouter } from 'next/router';
import { useState } from 'react';
import Link from 'next/link';
import { Box, AppBar, Toolbar, Typography, Button } from '@mui/material';


export default function TakeQuiz() {

  // -these values come from read-paper.js 
  const router = useRouter();
  const showPaper1 = router.query.showPaper1;
  const showPaper2 = router.query.showPaper2;
  const showPaper3 = router.query.showPaper3;

  // --these values come from user input 
  const [showScore, setShowScore] = useState(false);
  const [totalQuestions, setTotalQuestions] = useState('');
  const [totalCorrect, setCorrect] = useState('');

  // --updated hooks for new quiz w/ multiple answers per question
  const [paper1Q1Value, setPaper1Q1Value] = useState('');
  const [paper1Q2Value, setPaper1Q2Value] = useState(' ');
  const [paper2Q1Value, setPaper2Q1Value] = useState('');
  const [paper2Q2Value, setPaper2Q2Value] = useState(' ');  
  const [paper3Q1Value, setPaper3Q1Value] = useState('');
  const [paper3Q2Value, setPaper3Q2Value] = useState(' ');

  const goHome = () => {
    window.location.href = "http://letsgobiotech.com"; 
  }



  // handle paper 1 change 
  const handlePaper1Change = (event) => {
    const { name, value } = event.target;
    if (name === 'paper1-q1') {
      setPaper1Q1Value(value);
    } 
    else if (name === 'paper1-q2') {
      setPaper1Q2Value(value);
    }
  }
  // handle paper 2 change
  const handlePaper2Change = (event) => {
    const { name, value } = event.target;
    if (name === 'paper2-q1') {
      setPaper2Q1Value(value);
    }
    else if (name === 'paper2-q2') {
      setPaper2Q2Value(value);
    }
  }
  // handle paper 3 change
  const handlePaper3Change = (event) => { 
    const { name, value } = event.target;
    if (name === 'paper3-q1') {
      setPaper3Q1Value(value);
    }
    else if (name === 'paper3-q2') {
      setPaper3Q2Value(value);
    }
  }

  const scoreFun = () => {
    
    // correct answers to v4 quiz in order from q1 to qn
    const correctAnswersPaper1 = ['paper1-q1-c', 'paper1-q2-c'];
    const correctAnswersPaper2 = ['paper2-q1-c', 'paper2-q2-a'];
    const correctAnswersPaper3 = ['paper3-q1-a', 'paper3-q2-c'];

    let totalCorrect = 0;
    let totalQuestions = correctAnswersPaper1.length; 
    
    if (showPaper1 === 'true') {
      const userAnswers = [paper1Q1Value, paper1Q2Value];
      console.log(userAnswers);
      console.log(correctAnswersPaper1);
      totalCorrect = scorePaper(correctAnswersPaper1, userAnswers);
      console.log(totalCorrect);
    }

    if (showPaper2 === 'true')  {
      const userAnswers = [paper2Q1Value, paper2Q2Value];
      console.log(userAnswers);
      console.log(correctAnswersPaper2);
      totalCorrect = scorePaper(correctAnswersPaper2, userAnswers);
      console.log(totalCorrect);
    }

    if (showPaper3 === 'true') {
      const userAnswers = [paper3Q1Value, paper3Q2Value];
      console.log(userAnswers);
      console.log(correctAnswersPaper3);
      totalCorrect = scorePaper(correctAnswersPaper3, userAnswers);
      console.log(totalCorrect);
    }

    setTotalQuestions(totalQuestions);
    setCorrect(totalCorrect);

  }

  function scorePaper(correctAnswers, userAnswers) {
    let numQuestionsCorrect = 0
    for (let i = 0; i < correctAnswers.length; i++) {
        
        const correctAnswer = correctAnswers[i];
        const userAnswer = userAnswers[i];
        console.log(correctAnswer, userAnswer);
        if (correctAnswer === userAnswer) {
          numQuestionsCorrect += 1;
        }

    } 
    return numQuestionsCorrect; 
  }


 return (
   <div className={styles.container}>
      <Head>
        <title>Let's Go Biotech - Quiz</title>
        <meta name="description" content="Generated by create next app" />
      </Head>

      <AppBar position="fixed" color="secondary">
        <Toolbar>
          <Typography variant="h6" component="div" sx={{ flexGrow: 1 }} className={styles.cursorPointer} onClick={goHome}>
            Let's Go Biotech ðŸ§¬
          </Typography>
        </Toolbar>
      </AppBar>

      <br />

      {showPaper1 === 'true' && (
      <div className={styles.quizHellYa}>
        <Typography variant="body1" sx={{ mb: 2, fontSize: "1.5rem" }}>
          <span className={styles.lgbText}><i><b>What were the motivations behind the pioneering surgeries involving xenotransplantation?</b></i></span><br />
          <input type="radio" id="paper1-q1-a" name="paper1-q1" value="paper1-q1-a" onChange={handlePaper1Change}/>
          <label htmlFor="paper1-a"><span className={styles.lgbText}>To study the genetic modifications in pigs.</span></label><br />
          <input type="radio" id="paper1-q1-b" name="paper1-q1" value="paper1-q1-b" onChange={handlePaper1Change} />
          <label htmlFor="paper1-b"><span className={styles.lgbText}>To develop new surgical techniques.</span></label><br />
          <input type="radio" id="paper1-q1-c" name="paper1-q1" value="paper1-q1-c" onChange={handlePaper1Change} />
          <label htmlFor="paper1-q1-c"><span className={styles.lgbText}>To explore alternative organ sources for transplantation.</span></label><br /> <br />
       
          <span className={styles.lgbText}><i><b>What were the genetic modifications made to the pig organs for transplantation?</b></i></span><br />
          <input type="radio" id="paper1-q2-a" name="paper1-q2" value="paper1-q2-a" onChange={handlePaper1Change}/>
          <label htmlFor="paper1-q2-a"><span className={styles.lgbText}>Alterations to improve pig's intelligence.</span></label><br />
          <input type="radio" id="paper1-q2-b" name="paper1-q2" value="paper1-q2-b" onChange={handlePaper1Change} />
          <label htmlFor="paper1-q2-b"><span className={styles.lgbText}>Changes to enhance pig's fertility.</span></label><br />
          <input type="radio" id="paper1-q2-c" name="paper1-q2" value="paper1-q2-c" onChange={handlePaper1Change} />
          <label htmlFor="paper1-q2-c"><span className={styles.lgbText}>Modifications to lessen immune rejection</span></label>
        </Typography>
      </div>
      )}

      <br />

      {showPaper2 === 'true' && (
        <div className={styles.quizHellYa}>
          <Typography variant="body1" sx={{ mb: 2, fontSize: "1.5rem" }}>
            <span className={styles.lgbText}><i><b>What factors have been attributed to the diminishing returns in scientific innovation?</b></i></span><br />
            <input type="radio" id="paper2-q1-a" name="paper2-q1" value="paper2-q1-a" onChange={handlePaper2Change} />
            <label htmlFor="paper2-a"><span className={styles.lgbText}>It has limited the time available for exploratory topics and creativity.</span></label><br />
            <input type="radio" id="paper2-q1-b" name="paper2-q1" value="paper2-q1-b" onChange={handlePaper2Change} />
            <label htmlFor="paper2-b"><span className={styles.lgbText}>It has created a fast-paced environment with less room for transformative science.</span></label><br />
            <input type="radio" id="paper2-q1-c" name="paper2-q1" value="paper2-q1-c" onChange={handlePaper2Change} />
            <label htmlFor="paper2-c"><span className={styles.lgbText}>It has affected the training and development of graduate students and postdoctoral fellows.</span></label><br /> <br />

            <span className={styles.lgbText}><i><b>How has the shift towards a more results-oriented approach in science affected the culture?</b></i></span><br />
            <input type="radio" id="paper2-q2-a" name="paper2-q2" value="paper2-q2-a" onChange={handlePaper2Change} />
            <label htmlFor="paper2-d"><span className={styles.lgbText}>Fewer fundamental discoveries remaining to be made.</span></label><br />
            <input type="radio" id="paper2-q2-b" name="paper2-q2" value="paper2-q2-b" onChange={handlePaper2Change} />
            <label htmlFor="paper2-e"><span className={styles.lgbText}>Transition towards a more executive and results-oriented approach in the culture of science.</span></label><br />
            <input type="radio" id="paper2-q2-c" name="paper2-q2" value="paper2-q2-c" onChange={handlePaper2Change} />
            <label htmlFor="paper2-f"><span className={styles.lgbText}>Decreased time for exploratory topics due to the fast-paced nature of scientific work.</span></label><br /> <br />
          </Typography>
        </div>
      )}

      <br />

      {showPaper3 === 'true' && (
        <div className={styles.quizHellYa}>
        <Typography variant="body1" sx={{ mb: 2, fontSize: "1.5rem" }}>
          <span className={styles.lgbText}><b>Is Nano-tRNAseq as a cost-effective method for studying tRNA molecules?</b></span><br />
          <input type="radio" id="paper3-q1-a" name="paper3-q1" value="paper3-q1-a" onChange={handlePaper3Change} />
          <label htmlFor="paper3-a"><span className={styles.lgbText}>Yes</span></label><br />
          <input type="radio" id="paper3-q1-b" name="paper3-q1" value="paper3-q1-b" onChange={handlePaper3Change} />
          <label htmlFor="paper3-b"><span className={styles.lgbText}>No</span></label><br /> <br />
      
          <span className={styles.lgbText}><b>In what contexts can Nano-tRNAseq be applied to study the role of tRNA molecules?</b></span><br />
          <input type="radio" id="paper3-q2-a" name="paper3-q2" value="paper3-q2-a" onChange={handlePaper3Change} />
          <label htmlFor="paper3-c"><span className={styles.lgbText}>Disease Research</span></label><br />
          <input type="radio" id="paper3-q2-b" name="paper3-q2" value="paper3-q2-b" onChange={handlePaper3Change} />
          <label htmlFor="paper3-d"><span className={styles.lgbText}>Developmental Biology</span></label><br />
          <input type="radio" id="paper3-q2-c" name="paper3-q2" value="paper3-q2-c" onChange={handlePaper3Change} />
          <label htmlFor="paper3-d"><span className={styles.lgbText}>Both and many, many more</span></label><br />
        </Typography>
      </div>
      )} 

      <br />
      <br />


      {showScore && totalCorrect > 0 &&(
        <div className={styles.quizHellYa}>
          <Typography variant="body1" sx={{ mb: 2, fontSize: "1.5rem" }}>
            <span className={styles.lgbText}>Great job on reading new & hard material!< br />
            You got {totalCorrect} correct out of {totalQuestions}!</span> <br />

            <br />
            
            <Link className={styles.greenSquare} href="/select-paper" >
                <h2><span className={styles.lgbText}>Let's Try a New One!</span></h2>
            </Link>

          </Typography>
        </div>
      )}

      {showScore && totalCorrect === 0 && (
        <div className={styles.quizHellYa}>
          <Typography variant="body1" sx={{ mb: 2, fontSize: "1.5rem" }}>
              <span className={styles.lgbText}>Great job on reading the paper and trying to understand something complicated! < br />
              You didn't get any of the questions correct, no worries! <br /> <br />
              Re-read the abstract &darr; and try again!<br />
              </span>
            <Link className={styles.greenSquare} href="/select-paper">
            <h2><span className={styles.lgbText}>Back to Paper Selection!</span></h2>
            </Link> <br />
          </Typography>
        </div>
      )}

      {!showScore && (
      <Typography variant="body1" sx={{ mb: 2, fontSize: "1.5rem" }}>
        
        <Link className={styles.greenSquare} href="#" onClick={() => [ scoreFun() , setShowScore(true)]}>
            <h2><span className={styles.lgbText}>Finished? Let's See How You Did!</span></h2>
        </Link>

        {/* <Link
            className={styles.greenSquare} 
            href={{
                pathname: '/read-paper',
                query: {
                  showPaper1: showPaper1,
                  showPaper2: showPaper2,
                  showPaper3: showPaper3
                }
            }}>
            <h2><span className={styles.lgbText}>Read Abstract Again</span></h2>
        </Link>
       */}
      </Typography>
      )}

   </div>
 )
}
